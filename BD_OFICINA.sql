use BD_OFICINA;

#		DDL      #
CREATE DATABASE BD_OFICINA;
SELECT * FROM FUNCIONARIO;
CREATE TABLE FUNCIONARIO (
ID_FUNCIONARIO INT NOT NULL,
USUARIO VARCHAR (20) NOT NULL,
SENHA VARCHAR (20) NOT NULL,
NOME VARCHAR (50) NOT NULL,
DATA_NASCIMENTE DATE NOT NULL,
CPF VARCHAR (15) NOT NULL,
RG VARCHAR (15) NOT NULL,
ENDEREÇO VARCHAR (50) NOT NULL,
COMPLEMENTO VARCHAR (50),
CARGO VARCHAR (45),
OBSERVAÇAO VARCHAR (100),
PRIMARY KEY (ID_FUNCIONARIO)
);

CREATE TABLE ORÇAMENTO(
ID_ORÇAMENTO INT NOT NULL,
DATA DATE NOT NULL,
DESCRIÇAO VARCHAR (300) ,
VALOR DOUBLE,
SITUAÇAO VARCHAR (45),
FUNCIONARIO_ID_FUNCIONARIO INT,
PRIMARY KEY (ID_ORÇAMENTO),
CONSTRAINT FK_ORÇAMENTO_FUNCIONARIOS
FOREIGN KEY (FUNCIONARIO_ID_FUNCIONARIO) REFERENCES FUNCIONARIO (ID_FUNCIONARIO)
);

CREATE TABLE ATENDIMENTO (
ID_ATENDIMENTO INT,
DATA DATE,
DESCRIÇAO VARCHAR (300),
HORARIO TIME,
SITUAÇAO VARCHAR (45) NOT NULL,
FUNCIONARIO_ID_FUNCIONARIO INT,
CLIENTE_ID_CLIENTE INT,
ORÇAMENTO_ID_ORÇAMENTO INT,
PRIMARY KEY (ID_ATENDIMENTO),
CONSTRAINT FK_ATENDIMENTO_FUNCIONARIO
FOREIGN KEY (FUNCIONARIO_ID_FUNCIONARIO) REFERENCES FUNCIONARIO(ID_FUNCIONARIO),
CONSTRAINT FK_ATENDIMENTO_ORÇAMENTO
FOREIGN KEY (ORÇAMENTO_ID_ORÇAMENTO) REFERENCES ORÇAMENTO(ID_ORÇAMENTO),
CONSTRAINT FK_ATENDIMENTO_CLIENTE
FOREIGN KEY (CLIENTE_ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);
CREATE TABLE CLIENTE(
ID_CLIENTE INT,
CPF_CNPJ VARCHAR (20),
RAZAO_SOCIAL VARCHAR (45),
RG VARCHAR (12),
NOME VARCHAR (45) NOT NULL,
DATA_NASCIMENTO DATE NOT NULL,
CEP VARCHAR (45),
ESTADO VARCHAR (2) NOT NULL,
CIDADE VARCHAR (45) NOT NULL,
BAIRRO VARCHAR (45) NOT NULL,
ENDEREÇO VARCHAR (45) NOT NULL,
TELEFONE VARCHAR (15),
CELULAR VARCHAR (15),
PRIMARY KEY (ID_CLIENTE)
);
CREATE TABLE VEICULO(
ID_VEICULO INT,
PLACA VARCHAR (8) NOT NULL,
MARCA VARCHAR (15) NOT NULL,
MODELO VARCHAR (15) NOT NULL,
COR VARCHAR (15) NOT NULL,
CLIENTE_ID_CLIENTE INT,
PRIMARY KEY (ID_VEICULO),
CONSTRAINT FK_VEICULO_CLIENTE
FOREIGN KEY (CLIENTE_ID_CLIENTE) REFERENCES CLIENTE(ID_CLIENTE)
);
CREATE TABLE PEÇAS(
ID_PEÇAS INT,
NOME VARCHAR (50) NOT NULL,
QUANTIDADE INT NOT NULL,
VALOR DOUBLE,
DESCRIÇAO VARCHAR (300),
ORÇAMENTO_ID_ORÇAMENTO INT,
PRIMARY KEY (ID_PEÇAS),
FOREIGN KEY (ORÇAMENTO_ID_ORÇAMENTO) REFERENCES ORÇAMENTO(ID_ORÇAMENTO)

);

-- DML
-- adicionando dados
INSERT INTO FUNCIONARIO VALUES 
('1', 'MATHEUS_DANTAS','12345','MATHEUS DANTAS','1999-03-03','126.802.123-12','1232123','RUA DO MAR','CASA','ATENDENTE','MELHOR ATENDENTE DE 2012'),
('2', 'RAYSA_GOMES','54321','RAYSA GOMES','1996-06-22','345.213.163-12','2345679','RUA DO BEBEBO','CASA','ATENDENTE','MELHOR ATENDENTE DE 2017');
SELECT * FROM FUNCIONARIO;

INSERT INTO CLIENTE VALUES 
('1','128.098.097-12','','1111111','JOAO DOS SANTOS','1991-09-21','58111-001','PB','JOAO PESSOA','MANAIRA','RUA DO SOL','83-32456789','83-988776654'),
('2','029.345.011-12','','2222222','MILENA DA SILVA','1985-05-31','57011-001','PB','LUCENA','MANAIRA','RUA DO OURO','83-32400982','83-988733333'),
('3','112.345.021-12','','3333333','MARTA GOMES','1998-11-12','58112-112','PB','LUCENA','MANGABEIRA','AV SILVA E SANTOS','83-32665422','83-988765438'),
('4','233.777.009-12','','4444444','MARCELO DANTAS','1995-12-06','58811-221','PB','LUCENA','OITIZEIRO','AV. LUCIANO DA SILVA','83-32876904','83-986543298');

INSERT INTO VEICULO VALUES 
('1', 'QWER1234','HONDA','BROS 160','PRETO','1'),
('2', 'GHJK2345','KAWAZAKI','NINJA 300','AZUL','2'),
('3', 'ASDF6789','YAMAHA','FAZER 250','BRANCO','3'),
('4', 'RFDF6719','YAMAHA','XJ6 600','VERMELHO','4');

SELECT * FROM VEICULO;

INSERT INTO ATENDIMENTO VALUES
('1','2020-01-22','CABO DE LUBRIFICAÇAO','10:50:00','CONCLUIDO','1','1','1'),
('2','2020-02-01','PASTILHA DE FREIO','11:22:00','CONCLUIDO','2','2','2'),
('3','2020-02-08','TROCA DE OLEO','16:59:00','CONCLUIDO','3','3','3'),
('4','2020-02-12','TROCA DE RAIO','09:05:00','CONCLUIDO','4','4','4'),
('5','2020-02-23','TROCA DE PNEU','14:23:00','CONCLUIDO','5','5','5');
SET FOREIGN_KEY_CHECKS= 1;


INSERT INTO PEÇAS VALUES
('1','PASTILHA DE FREIO','4','120','PASTILHA DE FREIO PARA AUTOMOVEIS DA HONDA','1'),
('2','PNEUS MISTOS','2','340','PNEUS MISTOS PARA AUTOMOVEIS DA HONDA','2'),
('3','FREIO','2','220','FREIO PARA AUTOMOVEIS DA SUZUKI','3'),
('4','FAROL','4','110','FAROL PARA AUTOMOVEIS DA YAMAHA','4');


INSERT INTO ORÇAMENTO VALUES
('1','2020-02-01','PASTILHA DE FREIO','120','PAGO','1'),
('2','2020-02-01',' TROCA DE OLHO','80','PAGO','2');
INSERT INTO VEICULO VALUES 
('1',);

-- ATUALIZANDO DADOS 
UPDATE FUNCIONARIO SET NOME = 'RAYSA GOMES DA SILVA' WHERE ID_FUNCIONARIO = 2;
UPDATE FUNCIONARIO SET NOME = 'MATHEUS DANTAS DOS SANTOS' WHERE ID_FUNCIONARIO = 1;
SELECT * FROM FUNCIONARIO;

-- DELETANDO DADOS 
DELETE FROM CLIENTE;
DELETE FROM CLIENTE WHERE ID_CLIENTE = 1;

-- CONSULTAS
-- consulta retorna CPF ,endereço argo, para os funcionários que começa com a letra G
SELECT CPF, ENDEREÇO, CARGO FROM FUNCIONARIO WHERE NOME LIKE 'G%';
-- consulta retorna qtd de atendimentos por CPF do funcionário
SELECT COUNT(*) AS ID_ATENDIMENTO FROM ATENDIMENTO;
-- consulta que retorne valor médio das peças que tenha a qtd > maior que 30
SELECT AVG (VALOR) AS 'MEDIA DAS PEÇAS' FROM PEÇAS;
-- consulta que retorne todos os dados do cliente 
SELECT * FROM CLIENTE;
-- consulta retorna todas os dados do  orçamentos realizados no ano de 2020.
SELECT * FROM ORÇAMENTO WHERE DATA > 2020;
-- consulta que retorne a descrição para aqueles que possuem  orçamento de maior valor .
SELECT MAX(VALOR) AS 'MAIOR VALOR' FROM ORÇAMENTO;
-- consulta que retorne o nome do cliente a sua Cidade a placa a marca o modelo pra todos os veículos de cor azul branco preto e vermelho.
SELECT NOME , CIDADE, PLACA , MARCA , MODELO , COR 
FROM CLIENTE INNER JOIN VEICULO
ON ID_CLIENTE = CLIENTE_ID_CLIENTE;
-- consulta que retorne todos os dados da tabela cliente e a descrição do atendimento.
SELECT CPF_CNPJ, RAZAO_SOCIAL, RG, NOME, DATA_NASCIMENTO, CEP, ESTADO, CIDADE, BAIRRO, ENDEREÇO, TELEFONE, DESCRIÇAO 
FROM CLIENTE INNER JOIN ATENDIMENTO
ON ID_CLIENTE = CLIENTE_ID_CLIENTE 





